<!DOCTYPE html>
<html>
<head>
    <title>No shaders</title>
    <style>
        body { margin: 0; }
        canvas { width: 100%; height: 100% }
    </style>
</head>
<body>
<script src="libs/three.min.js"></script>
<script src="libs/FlyControls.js"></script>		
<script src="libs/OrbitControls.js"></script>
<script src="libs/perlin.js"></script>
<script src="libs/noise.js"></script>

<script>
	var Lines = [], n = 32, m = 32, k = 0;
	var pixelsX = 50, pixelsY = 50;
	var pixelSizeX = 10, pixelSizeY = 10;
	var perlinCycle          = 0;
	var perlinCycleIncrement = 0.075;
	var ribbons = [];
	var numRibbons = 1;
	var ribbonYDeviation = 200;
	var lastUpdate = 0;
	var w = window.innerWidth;
	var h =  window.innerHeigh;
    var Scene = new THREE.Scene();
    var Camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
    Camera.position.set(60, 60, 160);
    Camera.lookAt(new THREE.Vector3(0,0,0));

    Controls = new THREE.OrbitControls( Camera );

	Controls.rotateSpeed = 1.0;
	Controls.zoomSpeed = 1.2;
	Controls.panSpeed = 0.8;

	Controls.keys = [ 65, 83, 68 ];

  	noise.seed(Math.random());

    var Renderer = new THREE.WebGLRenderer();
    Renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( Renderer.domElement );

	/*for (var i=0; i<n; i++){
	    var material = new THREE.LineBasicMaterial({color: 0x0000ff});
	    var geometry = new THREE.Geometry();
	    for (var j=0; j<m; j++)
	    {
			var z = noise.perlin3(0.5, 0.5, perlinCycle);
			//var z = Math.random(0,10);
			
			z *= 10;
			geometry.vertices.push(new THREE.Vector3( -m/2 + j, z, -n/2 + i ));
  			perlinCycle += perlinCycleIncrement;
	    }
	    Lines.push(new THREE.Line( geometry, material ));
	    Scene.add( Lines[i] );
	}*/
/*
	for (var i=0; i<n; i++) {
	    var material = new THREE.LineBasicMaterial({color: 0x0000ff});
	    var geometry = new THREE.Geometry();
     	for (var j=0; j<m; j++) {
	      var noiseValue = noise.perlin3(i * 0.1, j * 0.1, perlinCycle);
	      noiseValue = Math.floor(scaleNoise(noiseValue) * 10);
		  geometry.vertices.push(new THREE.Vector3( -m/2 + j, noiseValue, -n/2 + i ));
	    }

	    Lines.push(new THREE.Line( geometry, material ));
	    Scene.add( Lines[i] );
	  }*/

	var textureLoader = new THREE.TextureLoader();
	var texture1 = textureLoader.load( "images/crate.gif" );

	/*var maxAnisotropy = Renderer.capabilities.getMaxAnisotropy();
	texture1.anisotropy = maxAnisotropy;
	texture1.wrapS = texture1.wrapT = THREE.RepeatWrapping;
	texture1.repeat.set( 512, 512 );*/
	var geometry = new THREE.PlaneBufferGeometry( 256, 256, 30, 30 );
	var material = new THREE.MeshBasicMaterial( {color: 0xffff00, side: THREE.DoubleSide, map: texture1} );
	var plane = new THREE.Mesh( geometry, material );
	plane.rotateX(Math.PI/2);
	Scene.add( plane );
	var array = plane.geometry.attributes.position.array;

	 for (var i=0; i<n; i++) {
     	for (var j=0; j<m; j++) {
			var noiseValue = noise.perlin3(i * 0.1, j * 0.1, perlinCycle);
			noiseValue = Math.floor(scaleNoise(noiseValue) * 50);
			var index = (i*n+j)*3+2;
			plane.geometry.attributes.position.array[index] = noiseValue;
	    }
	    //perlinCycle++;
	  }

    var animate = function () {

		Controls.update();
        requestAnimationFrame( animate );      
        Renderer.render(Scene, Camera);
    };

    animate();
</script>
</body>